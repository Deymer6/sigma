<div class="admin-container">
  
  <div class="header-actions">
    <h1 class="page-title">Gestión de Obstetras</h1>
    <div class="controls">
      <div class="search-box">
        <i class="bi bi-search"></i>
        <input [formControl]="searchControl" type="text" placeholder="Buscar obstetra...">
      </div>
      <button class="btn-new" (click)="abrirModalCrear()">
        <i class="bi bi-plus-lg"></i> Nuevo Obstetra
      </button>
    </div>
  </div>

  <!-- TABLA DE DATOS -->
  <div class="table-card">
    <table>
      <thead>
        <tr>
          <th>Profesional</th>
          <th>CMP / Colegiatura</th>
          <th>Especialidad</th>
          <th>Email</th>
          <th>Estado</th>
          <th class="text-end">Acciones</th>
        </tr>
      </thead>
      <tbody>
        @for (obs of obstetrasFiltrados(); track obs.id) {
          <tr>
            <td>
              <div class="user-info">
                <div class="avatar-circle">
                  <span>{{ obs.nombre.charAt(0) }}</span>
                </div>
                <div class="names">
                  <strong>Dr(a). {{ obs.nombre }} {{ obs.apellido }}</strong>
                </div>
              </div>
            </td>
            <td>{{ obs.numColegiatura }}</td>
            <td>{{ obs.especialidad }}</td>
            <td class="email-cell">{{ obs.email }}</td>
            <td>
              <span class="status-badge" [class.active]="obs.estado === 'Activo'" [class.inactive]="obs.estado !== 'Activo'">
                {{ obs.estado }}
              </span>
            </td>
            <td class="text-end">
              <button class="action-btn edit" (click)="abrirModalEditar(obs)" title="Editar">
                <i class="bi bi-pencil-square"></i>
              </button>
              <button class="action-btn delete" (click)="alternarEstado(obs)" [title]="obs.estado === 'Activo' ? 'Desactivar' : 'Activar'">
                <i class="bi" [class.bi-trash]="obs.estado === 'Activo'" [class.bi-arrow-counterclockwise]="obs.estado !== 'Activo'"></i>
              </button>
            </td>
          </tr>
        } @empty {
          <tr>
            <td colspan="6" class="empty-state">No se encontraron obstetras registrados.</td>
          </tr>
        }
      </tbody>
    </table>
  </div>

</div>

<!-- === MODAL REGISTRO/EDICIÓN === -->
@if (showModal()) {
  <div class="modal-overlay" (click)="cerrarModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      
      <div class="modal-header">
        <h3>{{ isEditing() ? 'Editar Obstetra' : 'Registrar Nuevo Obstetra' }}</h3>
        <button class="close-btn" (click)="cerrarModal()">&times;</button>
      </div>

      <div class="modal-body">
        <form [formGroup]="obstetraForm">
          
          <div class="row">
            <div class="form-group">
              <label>Nombre</label>
              <input type="text" formControlName="nombre" placeholder="Nombres">
            </div>
            <div class="form-group">
              <label>Apellido</label>
              <input type="text" formControlName="apellido" placeholder="Apellidos">
            </div>
          </div>

          <div class="row">
            <div class="form-group">
              <label>DNI / Documento</label>
              <input type="text" formControlName="dni" placeholder="DNI">
            </div>
            <div class="form-group">
              <label>Número Colegiatura (CMP)</label>
              <input type="text" formControlName="numColegiatura" placeholder="CMP 12345">
            </div>
          </div>

          <div class="form-group">
            <label>Especialidad</label>
            <select formControlName="especialidad">
              <option value="Ginecología y Obstetricia">Ginecología y Obstetricia</option>
              <option value="Enfermería">Enfermería</option>
            </select>
          </div>

          <div class="form-group">
            <label>Email Corporativo</label>
            <input type="email" formControlName="email" placeholder="email@clinica.com">
          </div>

          <div class="form-group">
            <label>Contraseña {{ isEditing() ? '(Opcional)' : '(Temporal)' }}</label>
            <div class="password-wrapper">
                <input type="password" formControlName="password" placeholder="********">
                <i class="bi bi-eye-slash"></i>
            </div>
            <small *ngIf="isEditing()" class="hint">Dejar en blanco para no cambiar</small>
          </div>

        </form>
      </div>

      <div class="modal-footer">
        <button class="btn-cancel" (click)="cerrarModal()">Cancelar</button>
        <button class="btn-save" (click)="guardar()">{{ isEditing() ? 'Guardar Cambios' : 'Registrar' }}</button>
      </div>

    </div>
  </div>
}