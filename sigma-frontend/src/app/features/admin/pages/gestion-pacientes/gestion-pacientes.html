<div class="admin-container">
  
  <div class="header-actions">
    <h1 class="page-title">Gestión de Pacientes</h1>
    <div class="controls">
      <div class="search-box">
        <i class="bi bi-search"></i>
        <input [formControl]="searchControl" type="text" placeholder="Buscar por DNI o Nombre...">
      </div>
      <button class="btn-new" (click)="abrirModalCrear()">
        <i class="bi bi-person-plus-fill"></i> Nuevo Paciente
      </button>
    </div>
  </div>

  <div class="table-card">
    <table>
      <thead>
        <tr>
          <th>Paciente</th>
          <th>DNI</th>
          <th>Estado</th> <th class="text-end">Acciones</th>
        </tr>
      </thead>
      <tbody>
        @for (paciente of pacientesFiltrados(); track paciente.idPaciente) {
          <tr>
            <td>
              <div class="user-info">
                <div class="avatar-circle">
                  <i class="bi bi-person"></i>
                </div>
                <div class="names">
                  <strong>{{ paciente.nombreCompleto }}</strong>
                </div>
              </div>
            </td>
            <td>{{ paciente.dni }}</td>
            <td>
              <span class="status-badge" 
                [class.active]="paciente.ultimaVisita === 'Activo'" 
                [class.inactive]="paciente.ultimaVisita !== 'Activo'">
                {{ paciente.ultimaVisita }}
              </span>
            </td>
            <td class="text-end">
              <button class="action-btn edit" (click)="abrirModalEditar(paciente)">
                <i class="bi bi-pencil-square"></i>
              </button>
              <button class="action-btn delete" (click)="alternarEstado(paciente)">
                <i class="bi bi-power"></i>
              </button>
            </td>
          </tr>
        } @empty {
          <tr><td colspan="4" class="empty-state">No hay pacientes registrados.</td></tr>
        }
      </tbody>
    </table>
  </div>

</div>

@if (showModal()) {
  <div class="modal-overlay" (click)="cerrarModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>{{ isEditing() ? 'Editar Datos' : 'Registrar Paciente' }}</h3>
        <button class="close-btn" (click)="cerrarModal()">&times;</button>
      </div>
      <div class="modal-body">
        <form [formGroup]="pacienteForm">
          <div class="row">
            <div class="form-group">
              <label>Nombre</label>
              <input type="text" formControlName="nombre">
            </div>
            <div class="form-group">
              <label>Apellido</label>
              <input type="text" formControlName="apellido">
            </div>
          </div>
          <div class="form-group">
            <label>DNI</label>
            <input type="text" formControlName="dni">
          </div>
          <div class="form-group">
            <label>Email</label>
            <input type="email" formControlName="email">
          </div>
          <div class="form-group">
            <label>Contraseña {{ isEditing() ? '(Opcional)' : '' }}</label>
            <input type="password" formControlName="password">
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn-cancel" (click)="cerrarModal()">Cancelar</button>
        <button class="btn-save" (click)="guardar()">Guardar</button>
      </div>
    </div>
  </div>
}